#!/bin/bash

BOX=$(stb_addr)

echo "adb_link: Found $BOX, connecting..."
trap "echo adb_link: Interrupted...;exit" INT

while [[ 1 ]]
do
    output=$(timeout --foreground -k 10 5 adb connect "$BOX")

    # check for interrupt
    test $? -gt 128 && break; 

    if [[ "$output" =~ ^.*connected.*$ ]]; then
        echo "adb_link: Connected to $BOX"
        exit 0
    else
        sleep 1
    fi
done
